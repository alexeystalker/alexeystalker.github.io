---
tags: [Elasticsearch/aggs]
share: true
---
# Terms Aggregation
Агрегация с динамическим количеством корзин (по числу уникальных значений)
Запрос:
```json
{
	"aggs": {
		"okveds": {
			"terms": {
				"field": "okved-xtr-exact",
				"size": 10000
			}
		}
	}
}
```
Параметры:
1. `field` — поле, по значениям которого создаются корзины и ведется подсчет
2. `size` — максимальное количество корзин. Сверху ограничено параметром кластера analyze.max_token_count (вроде бы)
3. `include` — список термов, корзины с которыми должны быть в выдаче. Если нет документов с каким-то термом, корзины с 0 документов не будет
4. `exclude` — список термов, корзины с которыми нужно исключить из выдачи
остальные см. по ссылке.

Результат:
![[Pasted image 20210730121728.png]]
Здесь:
1. Верхняя граница ошибки подсчета. Примерно означает, что подсчет документов в корзинах расходится с правдой не более чем на столько
2. количество документов, не попавших в показанные корзины
3. запрошенное число корзин, отсортированных согласно параметру `order` (см. доку)
## Ссылки
https://www.elastic.co/guide/en/elasticsearch/reference/7.8/search-aggregations-bucket-terms-aggregation.html
