---
share: true
tags:
 - NET/ASPNETCore/filters
---
# Порядок выполнения фильтров
Конвейер фильтров содержит пять этапов, которые всегда выполняются в фиксированном порядке, как описано [[ch-13-mvc-filter-pipeline|здесь]] и [[ch-13-razor-pages-filter-pipeline|здесь]]. На каждом этапе может быть несколько фильтров одного типа, при этом они могут иметь несколько [[filter-scope|областей действия]], в зависимости от того, [[ch-13-adding-filters|как их добавили]].
Рассмотрим порядок исполнения фильтров в рамках определенного этапа, и то, как на него влияет область действия.
## Порядок выполнения фильтров по умолчанию
Важно помнить, что фильтры ресурсов , действий и результатов выполняются дважды - метод `*Executing` до [[action-method|метода действия]], и `*Executed` после метода. А фильтры страниц реализуют три метода.
Порядок выполнения фильтров по умолчанию зависит от области действия фильтра, как показано на рисунке (для фильтра ресурсов)
![[Pasted image 20220510182648.png]]
Фильтры выполняются, начиная с самой широкой области (глобальные), до самой узкой (действие) при выполнении метода `*Executing`. Для метода `*Executed` выполнение происходит в обратном порядке.
Для страниц Razor глобальные фильтры сначала выполняют методы `*Executing` и `PageHandlerSelected`, затем их же выполняют фильтры страниц. Для методов `*Executed` порядок обратный.

## Переопределение порядка выполнения фильтров по умолчанию с помощью интерфейса `IOrderedFilter`
Для точного контроля порядка выполнения фильтров необходимо реализовать интерфейс `IOrderedFilter`:
```csharp
public interface IOrderedFilter
{
	int Order { get; }
}
```
Конвейер фильтров упорядочивает фильтры определенного этапа сначала на основе этого значения, от наименьшего до наивысшего, затем использует порядок фильтров по умолчанию для фильтров с одинаковыми значениями. См. рисунок:
![[Pasted image 20220513174509.png]]
Все фильтры, поставляемые с ASP.NET Core, имеют `Order = 0`.
