---
share: true
tags:
 - microservice/transaction
 - microservice/saga
 - microservice/isolation
---
# Недостаточная изолированность
Изолированность (isolation в аббревиатуре ACID) гарантирует, что результат параллельного выполнения нескольких ACID транзакций будет таким же, как при некоем последовательном выполнении. База Данных дает иллюзию того, что каждая ACID транзакция имеет эксклюзивный доступ к информации.
В случае с повествованиями мы имеем дело с ситуацией, когда каждая локальная транзакция сразу же фиксируется и обновления становятся доступными другим повествованиям, следовательно, либо их могут изменить другие повествования до окончания текущего, либо другие повествования смогут их прочитать.
Нехватка изолированности может вызывать *аномалии* — ситуации, когда параллельное выполнение транзакций даёт иные результаты, чем последовательное. Для борьбы с аномалиями применяют  стратегии проектирования повествований, называемые *контрмерами*.
## Аномалии
- [[update-loss-problem|Потеря обновлений]] — одно повествование перезаписывает изменения, внесенные другим, не читая их при этом;
- [[dirty-reading-problem|"Грязное" чтение]] — транзакция или повествование читают незавершенные обновления другого повествования;
- [[fuzzy-reading-problem|Нечеткое чтение]] — два разных типа повествования читают одни и те же данные,но получают разные результаты, потому что другое повествование внесло изменения.
## Контрмеры
+ [[semantic-lock-countermeasure|Семантическая блокировка]] — блокировка на уровне приложения;
+ [[commutative-updates-countermeasure|Коммутативные обновления]] — проектирование операций обновления так, чтобы их можно было выполнить в любом порядке;
+ [[pessimistic-view-countermeasure|Пессимистическое представление]] — перестановка этапов повествования для минимизации бизнес-рисков;
+ [[second-read-countermeasure|Повторное чтение значения]] — предотвращение грязного чтения путём повторного чтения данных, чтобы убедиться в их неизменности перед перезаписью;
+ [[version-file-countermeasure|Файл версий]] — ведение записей об обновлениях, чтобы их можно было менять местами;
+ [[by-value-countermeasure|По значению]] — использование бизнес-рисков каждого запроса для динамического выбора механизма конкурентности.

Полезно иметь в виду [[saga-structure|структуру повествования]].