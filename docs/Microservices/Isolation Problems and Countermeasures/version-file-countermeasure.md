---
share: true
tags:
 - microservice/transaction
 - microservice/isolation/countermeasure
---
# Контрмера “файл версий”
*Файл версий* назван так потому, что в него записываются операции, которые выполняются с записью. Благодаря этому порядок следования операций можно менять. Это способ превращения некоммутативных операций в коммутативные.

Рассмотрим сценарий, в котором повествования `Create Order` и `Cancel Order` выполняются параллельно. Если не применяется [[semantic-lock-countermeasure|семантическая блокировка]], существует вероятность того, что `Cancel Order` отменит авторизацию карты до того, как Create Order её авторизует.
Чтобы справиться с этим, записываем операции по мере поступления, и затем выполняем в правильном порядке. Сначала запишем запрос `Cancel Authorization`. Затем, получив запрос `Authorize Card` просто пропустим его, так как уже есть информация о `Cancel Authorization`.